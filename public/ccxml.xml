<?xml version="1.0" encoding="UTF-8"?>
<!-- NOTE THAT WE *MUST* DECLARE THE xmlns ATTRIBUTE -->
<ccxml version="1.0" xmlns:voxeo="http://community.voxeo.com/xmlns/ccxml">

  <var name="myDialogID"/>
  <var name="myState" expr="'init'"/>

  <eventprocessor statevariable="myState">

    <transition event="connection.alerting" state="init">
      <log expr="'***** CONNECTION ALERTING *****'"/>
      <accept/>
    </transition>


    <transition event="connection.connected" state="init">
      <log expr="'***** CALL WAS ANSWERED *****'"/>

      <log expr="'***** EVENT$.CONNECTION.CONNECTIONID = ' + event$.connection.connectionid"/>
      <log expr="'***** EVENT$.CONNECTION.PROTOCOL.NAME = ' + event$.connection.protocol.name"/>
      <log expr="'***** EVENT$.CONNECTION.PROTOCOL.VERSION = ' + event$.connection.protocol.version"/>
      <log expr="'***** EVENT$.CONNECTION.STATE = ' + event$.connection.state"/>
      <log expr="'***** EVENT$.CONNECTION.LOCAL = ' + event$.connection.local"/>
      <log expr="'***** EVENT$.CONNECTION.REMOTE = ' + event$.connection.remote"/>
      <log expr="'***** EVENT$.CONNECTION.ORIGINATOR = ' + event$.connection.originator"/>

      <dialogstart src="'http://blindpages.com/home?format=xml'" type="'application/voicexml+xml'" dialogid="myDialogID"/>
      <assign name="myState" expr="'dialogActive'" />
      <send name="'timeout'" target="session.id" delay="'600s'"/>
    </transition>


    <transition event="timeout" state="dialogActive">
      <log expr="'***** TIMEOUT RECEIVED, NOW TERMINATING THE DIALOG *****'"/>
      <dialogterminate dialogid="myDialogID" immediate="false"/>
    </transition>


    <transition event="send.successful" state="dialogActive">
      <log expr="'***** SEND IS SUCCESSFUL *****'"/>
    </transition>


    <transition event="error.dialog.notstarted'">
      <log expr="'****** ERROR.DIALOGNOTSTARTED.NAME = ' + event$.name"/>
      <log expr="'***** EVENT$.NAME  = ' + event$.name"/>
      <log expr="'***** EVENT$.DIALOGID  = ' + event$.dialogid"/>
      <log expr="'***** EVENT$.DIALOG  = ' + event$.dialog"/>
      <log expr="'***** EVENT$.CONFERENCEID  = ' + event$.conferenceid"/>
      <log expr="'***** EVENT$.CONNECTIONID  = ' + event$.connectionid"/>
      <log expr="'***** EVENT$.REASON  = ' + event$.reason"/>
      <log expr="'***** EVENT$.EVENTID  = ' + event$.eventid"/>
      <log expr="'***** EVENT$.EVENTSOURCE  = ' + event$.eventsource"/>
      <log expr="'***** EVENT$.EVENTSOURCETYPE  = ' + event$.eventsourcetype"/>
      <exit/>
    </transition>

    <transition event="error.send.targetunavailable">
      <log expr="'***** SEND TARGET UNAVAILABLE *****'"/>
      <exit/>
    </transition>


    <transition event="dialog.exit" state="'dialogActive'">
      <log expr="'***** DIALOG EXIT IN DIALOG ACTIVE STATE *****'"/>
      <exit/>
    </transition>   

    <transition event="dialog.exit">
      <log expr="'***** CALL EXITING *****'"/>
      <log expr="'***** event$.VALUES.F_1 =' + event$.values.F_1"/>
      <log expr="'***** EVENT$.NAME  = ' + event$.name"/>
      <log expr="'***** EVENT$.DIALOGID  = ' + event$.dialogid"/>
      <log expr="'***** EVENT$.CONFERENCEID  = ' + event$.conferenceid"/>
      <log expr="'***** EVENT$.CONNECTIONID  = ' + event$.connectionid"/>
      <log expr="'***** EVENT$.EVENTID  = ' + event$.eventid"/>
      <log expr="'***** EVENT$.EVENTSOURCE  = ' + event$.eventsource"/>
      <log expr="'***** EVENT$.EVENTSOURCETYPE  = ' + event$.eventsourcetype"/>
     
      <!-- DIALOG OBJECT PROPERTIES -->
      <log expr="'***** EVENT$.DIALOG.DIALOGID = ' + event$.dialog.dialogid"/>
      <log expr="'***** EVENT$.DIALOG.CONNECTIONID = ' + event$.dialog.connectionid"/>
      <log expr="'***** EVENT$.DIALOG.CONFERENCEID = ' + event$.dialog.conferenceid"/>
      <log expr="'***** EVENT$.DIALOG.TYPE = ' + event$.dialog.type"/>
      <log expr="'***** EVENT$.DIALOG.SRC = ' + event$.dialog.src"/>
      <log expr="'***** EVENT$.DIALOG.INPUT = ' + event$.dialog.input"/>
      <log expr="'***** EVENT$.DIALOG.OUTPUTS = ' + event$.dialog.outputs"/>
      <exit/>
    </transition>


    <transition event="error.*">
      <log expr="'an error has occured (' + event$.reason + ')'"/>
      <log expr="'***  EVENT$.NAME = ' + event$.name"/>
      <log expr="'***  EVENT$.REASON = ' + event$.reason"/>
      <log expr="'***  EVENT$.TAGNAME = ' + event$.tagname"/>
      <log expr="'***  EVENT$.EVENTID = ' + event$.eventid"/>
      <log expr="'***  EVENT$.EVENTSOURCE = ' + event$.eventsource"/>
      <log expr="'***  EVENT$.EVENTSOURCETYPE = ' + event$.eventsourcetype"/>
      <voxeo:sendemail to="'squirrel@blindpages.com'"
                        from="'myApp@here.com'"
                        type="'debug'"
                        body="'We had an error! \n Time to panic! \n
                            Flee the cities, abandon all hope!'"/>

      <exit/>
    </transition>
  </eventprocessor>
</ccxml>
